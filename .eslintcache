[{"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\reportWebVitals.js":"1","E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\App.js":"2","E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\index.js":"3","E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\Login.jsx":"4","E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\Home.jsx":"5","E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\Layout.jsx":"6","E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\Navbar.jsx":"7","E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\TopicElement.jsx":"8","E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\UserTopics.jsx":"9","E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\database\\firebase.js":"10","E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\Topic.jsx":"11","E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\SearchBar.jsx":"12","E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\ImageDropzone.jsx":"13","E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\resources\\strings.js":"14","E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\ReportPage.jsx":"15","E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\Reports.jsx":"16","E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\store\\store.js":"17"},{"size":362,"mtime":1612095212246,"results":"18","hashOfConfig":"19"},{"size":952,"mtime":1615282301545,"results":"20","hashOfConfig":"19"},{"size":690,"mtime":1615277887053,"results":"21","hashOfConfig":"19"},{"size":2314,"mtime":1615365062719,"results":"22","hashOfConfig":"19"},{"size":1161,"mtime":1615364815265,"results":"23","hashOfConfig":"19"},{"size":386,"mtime":1612114022679,"results":"24","hashOfConfig":"19"},{"size":4747,"mtime":1615365028547,"results":"25","hashOfConfig":"19"},{"size":3437,"mtime":1615368183856,"results":"26","hashOfConfig":"19"},{"size":7258,"mtime":1615367418257,"results":"27","hashOfConfig":"19"},{"size":678,"mtime":1612355262595,"results":"28","hashOfConfig":"19"},{"size":6112,"mtime":1615282181529,"results":"29","hashOfConfig":"19"},{"size":562,"mtime":1614177403657,"results":"30","hashOfConfig":"19"},{"size":5735,"mtime":1614862491940,"results":"31","hashOfConfig":"19"},{"size":5094,"mtime":1615215934761,"results":"32","hashOfConfig":"19"},{"size":7667,"mtime":1615215825648,"results":"33","hashOfConfig":"19"},{"size":2111,"mtime":1615213874198,"results":"34","hashOfConfig":"19"},{"size":1175,"mtime":1615367498181,"results":"35","hashOfConfig":"19"},{"filePath":"36","messages":"37","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"38"},"16ts6m3",{"filePath":"39","messages":"40","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"41","messages":"42","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"43"},{"filePath":"44","messages":"45","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"46","messages":"47","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"48","messages":"49","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"50","messages":"51","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"52","messages":"53","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"54","messages":"55","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"56","messages":"57","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"58","messages":"59","errorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"60","messages":"61","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"62","messages":"63","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"64","messages":"65","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"66","messages":"67","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"68","usedDeprecatedRules":"69"},{"filePath":"70","messages":"71","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"72","messages":"73","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\reportWebVitals.js",[],["74","75"],"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\App.js",[],"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\index.js",[],["76","77"],"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\Login.jsx",[],"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\Home.jsx",[],"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\Layout.jsx",[],"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\Navbar.jsx",[],"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\TopicElement.jsx",[],"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\UserTopics.jsx",[],"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\database\\firebase.js",[],"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\Topic.jsx",["78","79","80","81","82","83"],"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\SearchBar.jsx",[],"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\ImageDropzone.jsx",[],"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\resources\\strings.js",[],"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\ReportPage.jsx",["84"],"import React, {useState, useEffect} from 'react';\r\nimport ReCAPTCHA from \"react-google-recaptcha\";\r\nimport ImageDropzone from \"./ImageDropzone\";\r\nimport {db, storage} from \"../database/firebase\";\r\nimport firebase from \"firebase/app\";\r\nimport { useHistory, useParams } from \"react-router-dom\";\r\nimport { ToastContainer, toast } from 'react-toastify';\r\nimport stringRes from \"../resources/strings\";\r\nimport \"../assets/css/ReportPage.css\";\r\nimport 'react-toastify/dist/ReactToastify.css';\r\n\r\nfunction ReportPage() {\r\n\r\n    const history = useHistory();\r\n    const params = useParams();\r\n    const recaptchaRef = React.useRef();\r\n    \r\n    let language = process.env.REACT_APP_LANGUAGE;\r\n    let strings = stringRes[language];\r\n\r\n    const [files, setFiles] = useState([]); // for storing image(s) uploaded by user\r\n\r\n    const [reportText, setReportText] = useState(\"\"); // text reported by user\r\n\r\n    const [isUploading, setIsUploading] = useState(false);\r\n    const sourceCode = strings.report.sourceCode;\r\n\r\n    const [userId, setUserId] = useState(null);\r\n    const [topicId, setTopicId] = useState(null);\r\n    const [topic, setTopic] = useState({});\r\n\r\n    useEffect(() => {\r\n        \r\n        const userid = params.userId;\r\n        const topicid = params.topicId;\r\n       \r\n        if(userid !== null && topicid !== null) {\r\n           setUserId(userid);\r\n           setTopicId(topicid);\r\n           getTopicDetails(userid, topicid);\r\n        }\r\n        else {\r\n            history.push(\"/\");\r\n        }\r\n        // eslint-disable-next-line\r\n    }, []);\r\n\r\n\r\n    const getTopicDetails = (userGoogleId, topicId) => {\r\n        db.ref(`topics/${userGoogleId}/${topicId}`).on(\"value\", (snapshot) => {\r\n            if(snapshot.val()) {\r\n                setTopic(snapshot.val());\r\n            }\r\n        });\r\n    }\r\n\r\n    const notifySuccess = (message) => toast.success(message);\r\n    const notifyError = (message) => toast.error(message);\r\n\r\n    const handleTextChange = (e) => {\r\n        setReportText(e.target.value);\r\n    }\r\n\r\n    const onCaptchaChange = (token) => {\r\n      \r\n    }\r\n\r\n    // resets state values and reCaptcha\r\n    const resetPage = () => {\r\n        setReportText(\"\");\r\n        setFiles([]);\r\n        recaptchaRef.current.props.grecaptcha.reset();\r\n    }\r\n\r\n    // uploads image to firebase storage\r\n    // on success return the image's download URL\r\n    // on error throws error\r\n    const uploadFromBlobAsync = async ({blobUrl, name}) => {\r\n        if (!blobUrl || !name) return null;\r\n        try {\r\n            const blob = await fetch(blobUrl).then((r) => r.blob());\r\n            const snapshot = await storage.ref(\"report_images\").child(name).put(blob);\r\n            return await snapshot.ref.getDownloadURL();\r\n        } catch (error) {\r\n            notifyError(error);\r\n        }\r\n    }\r\n\r\n    // uploads the reported text to firestore\r\n    // if it's provided, uploads the given image's download URL, otherwise null\r\n    const uploadReport = async (url) => {\r\n        const dbRef = db.ref(`reports/${topicId}`);\r\n        const uid = dbRef.push().key; // getting a new id for the topic\r\n        const date = `${Date.now()}`;\r\n\r\n        dbRef.child(uid).set({\r\n            date : date,\r\n            text: reportText,\r\n            imageUrl: url,\r\n            topicOwnerId: userId\r\n        }).catch((error) => notifyError(error));\r\n\r\n    }\r\n\r\n    // if the user provided an image, upload it to firebase storage, then upload the report\r\n    const uploadToFirebase = () => {\r\n        if(files.length) {\r\n            try {\r\n                const url = uploadFromBlobAsync({\r\n                    blobUrl: URL.createObjectURL(files[0]),\r\n                    name: files[0].name\r\n                })\r\n                url.then((downloadURL) => {\r\n                    uploadReport(downloadURL);\r\n                });\r\n                return\r\n            }\r\n            catch (e) {\r\n                setIsUploading(false)\r\n                notifyError(e.message)\r\n                return\r\n            }\r\n        }\r\n        else {\r\n            uploadReport(null);\r\n        }\r\n    }\r\n\r\n\r\n    // when the user presses the submit button\r\n    const onSubmitWithReCAPTCHA = async () => {\r\n        const token = await recaptchaRef.current.props.grecaptcha.getResponse();\r\n        // if the reCaptcha's token is empty string or null, means that the user did not solve the captcha\r\n        \r\n        if(token === \"\" || token === null) {\r\n            notifyError(strings.report.errorText.notRobot);\r\n            return;\r\n        }\r\n\r\n        // if the given text for report is too short\r\n        if(reportText.length < 20) {\r\n            notifyError(strings.report.errorText.shortReport);\r\n            return;\r\n        }\r\n        setIsUploading(true); // setting up loader\r\n        uploadToFirebase(); // try to upload the image and report\r\n        setIsUploading(false);\r\n\r\n        // providing success message for 2 secs\r\n        notifySuccess(strings.report.errorText.successfulReport);\r\n        \r\n        resetPage();\r\n    }\r\n\r\n    return (\r\n        <div className=\"report-container\">\r\n            <div className=\"report-container__content\">\r\n                <div className=\"report-text\">\r\n                    <div className=\"info\">\r\n                        <div className=\"info-text\">\r\n                            {strings.report.title}\r\n                            <span className=\"info-text__topic-name\">  {topic.topicName}</span>\r\n                        </div>\r\n                    \r\n                    </div>\r\n                    <textarea \r\n                        className=\"text-input\" \r\n                        value = {reportText}\r\n                        placeholder={strings.report.inputPlaceHolder} \r\n                        onChange={handleTextChange}\r\n                    />\r\n                    <div className=\"source-code\">\r\n                            {`${strings.report.sourceCodeText}: `}\r\n                            <a \r\n                                target=\"blank\" \r\n                                href={`${sourceCode}`} \r\n                                className=\"source-code__link\"\r\n                            >\r\n                                {strings.report.sourceCodeShort}\r\n                            </a>\r\n                    </div>\r\n                </div>\r\n                <div className=\"report-image\">\r\n                    <div className=\"info\">\r\n                        <div className=\"info-text\">\r\n                            {strings.report.attachImageText}\r\n                        </div>\r\n                    </div>\r\n                    <ImageDropzone setUploadedImages={setFiles} files={files} />\r\n                </div>\r\n            </div>\r\n            <div className=\"bottom-submit__container\">\r\n                <div className=\"submit-container\">\r\n                    <ReCAPTCHA \r\n                        className=\"recaptcha\"\r\n                        ref = {recaptchaRef}\r\n                        sitekey = {process.env.REACT_APP_RECAPTCHA_SITE_KEY}\r\n                        onChange = {onCaptchaChange}\r\n                    />\r\n                    <button className=\"submit-button\" type=\"submit\" onClick={onSubmitWithReCAPTCHA} >{strings.report.submitButtonText}</button>\r\n                    {/*  */}\r\n                    {isUploading && (<div className=\"loader\"></div>)}\r\n                </div>\r\n            </div>\r\n            <ToastContainer \r\n                position=\"bottom-right\"\r\n                pauseOnHover={false}\r\n                hideProgressBar={true}\r\n                autoClose={3000}\r\n                closeOnClick={false}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ReportPage;",["85","86"],"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\components\\Reports.jsx",[],"E:\\Egyetem\\V\\Államvizsga\\feedback\\src\\store\\store.js",[],{"ruleId":"87","replacedBy":"88"},{"ruleId":"89","replacedBy":"90"},{"ruleId":"87","replacedBy":"91"},{"ruleId":"89","replacedBy":"92"},{"ruleId":"93","severity":1,"message":"94","line":123,"column":22,"nodeType":"95","messageId":"96","endLine":123,"endColumn":24},{"ruleId":"93","severity":1,"message":"94","line":128,"column":22,"nodeType":"95","messageId":"96","endLine":128,"endColumn":24},{"ruleId":"93","severity":1,"message":"94","line":128,"column":50,"nodeType":"95","messageId":"96","endLine":128,"endColumn":52},{"ruleId":"93","severity":1,"message":"94","line":133,"column":22,"nodeType":"95","messageId":"96","endLine":133,"endColumn":24},{"ruleId":"97","severity":1,"message":"98","line":140,"column":11,"nodeType":"99","messageId":"100","endLine":140,"endColumn":28},{"ruleId":"93","severity":1,"message":"94","line":155,"column":28,"nodeType":"95","messageId":"96","endLine":155,"endColumn":30},{"ruleId":"97","severity":1,"message":"101","line":5,"column":8,"nodeType":"99","messageId":"100","endLine":5,"endColumn":16},{"ruleId":"87","replacedBy":"102"},{"ruleId":"89","replacedBy":"103"},"no-native-reassign",["104"],"no-negated-in-lhs",["105"],["104"],["105"],"eqeqeq","Expected '===' and instead saw '=='.","BinaryExpression","unexpected","no-unused-vars","'DeleteTopicButton' is assigned a value but never used.","Identifier","unusedVar","'firebase' is defined but never used.",["104"],["105"],"no-global-assign","no-unsafe-negation"]